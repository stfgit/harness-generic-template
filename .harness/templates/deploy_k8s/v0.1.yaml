template:
  name: deploy k8s
  type: Stage
  orgIdentifier: stf
  tags:
    k8s: ""
    rolling deployment: ""
  icon: data:image/png;base64,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
  spec:
    type: Deployment
    spec:
      deploymentType: Kubernetes
      environment:
        environmentRef: <+input>
        deployToAll: false
        environmentInputs: <+input>
        serviceOverrideInputs: <+input>
        infrastructureDefinitions: <+input>
      service:
        serviceRef: <+input>
        serviceInputs: <+input>
        failureStrategies:
          - onFailure:
              errors:
                - AllErrors
              action:
                type: MarkAsFailure
      execution:
        steps:
          - step:
              name: Rollout Deployment
              identifier: rolloutDeployment
              type: K8sRollingDeploy
              timeout: 10m
              spec:
                skipDryRun: false
                pruningEnabled: false
        rollbackSteps:
          - step:
              name: Rollback Rollout Deployment
              identifier: rollbackRolloutDeployment
              type: K8sRollingRollback
              timeout: 10m
              spec:
                pruningEnabled: false
    failureStrategies:
      - onFailure:
          errors:
            - AllErrors
          action:
            type: StageRollback
  identifier: deploy_k8s
  versionLabel: v0.1
