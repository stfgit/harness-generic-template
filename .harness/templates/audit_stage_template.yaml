template:
  name: audit_stage_template
  identifier: audit_stage_template
  versionLabel: v1
  type: Stage
  spec:
    type: CI
    spec:
      infrastructure:
        type: KubernetesDirect
        spec:
          connectorRef: <+input>
          namespace: ci-audit
          os: Linux
      execution:
        steps:
          - step:
              name: NPM Audit
              identifier: npm_audit
              type: Run
              spec:
                image: node:18
                shell: Bash
                command: |
                  mkdir -p audit
                  npm audit --audit-level=high --json > audit/audit-report.json || true
                  cat audit/audit-report.json
